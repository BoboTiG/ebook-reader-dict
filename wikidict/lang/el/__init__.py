"""Greek language."""

import re
from collections import defaultdict

from ...user_functions import italic, unique
from .aliases import aliases
from .langs import langs

# Float number separator
float_separator = ","

# Thousands separator
thousands_separator = "."

# Markers for sections that contain interesting text to analyse.
head_sections = ("{{-el-}}",)
etyl_section = ("{{ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±}}",)
section_sublevels = (3, 4)
section_patterns = ("#", r"\*")
sections = (
    *head_sections,
    *etyl_section,
    "{{Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÏŒ}",
    "{{Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÏŒ|el}",
    "{{ÏÎ®Î¼Î±}",
    "{{ÏÎ®Î¼Î±|el}",
    "{{ÎµÏ€Î¯Î¸ÎµÏ„Î¿}",
    "{{ÎµÏ€Î¯Î¸ÎµÏ„Î¿|el}",
    "{{ÎµÏ€Î¯ÏÏÎ·Î¼Î±}",
    "{{ÎµÏ€Î¯ÏÏÎ·Î¼Î±|el}",
    "{{ÎµÏ€Î¯Î¸Î·Î¼Î±}",
    "{{ÎµÏ€Î¯Î¸Î·Î¼Î±|el}",
    "{{ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿Ï‚}",
    "{{ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿Ï‚|el}",
    "{{ÏƒÏ…Î½Ï„Î¿Î¼Î¿Î¼Î¿ÏÏ†Î®}",
    "{{ÏƒÏ…Î½Ï„Î¿Î¼Î¿Î¼Î¿ÏÏ†Î®|el}",
    "{{Î±ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÏŒ}",
    "{{Î±ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÏŒ|el}",
    "{{Î¬ÏÎ¸ÏÎ¿}",
    "{{Î¬ÏÎ¸ÏÎ¿|el}",
    "{{Î¼ÎµÏ„Î¿Ï‡Î®}",
    "{{Î¼ÎµÏ„Î¿Ï‡Î®|el}",
    "{{Î¼ÏŒÏÎ¹Î¿}",
    "{{Î¼ÏŒÏÎ¹Î¿|el}",
    "{{Î±Î½Ï„Ï‰Î½Ï…Î¼Î¯Î±}",
    "{{Î±Î½Ï„Ï‰Î½Ï…Î¼Î¯Î±|el}",
    "{{ÎµÏ€Î¹Ï†ÏÎ½Î·Î¼Î±}",
    "{{ÎµÏ€Î¹Ï†ÏÎ½Î·Î¼Î±|el}",
    "{{ÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ·}",
    "{{ÎµÏ€Î¹ÏÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ·}",
    "{{Ï†ÏÎ¬ÏƒÎ·}",
    "{{Ï†ÏÎ¬ÏƒÎ·|el}",
    "{{Î­ÎºÏ†ÏÎ±ÏƒÎ·}",
    "{{Î­ÎºÏ†ÏÎ±ÏƒÎ·|el}",
    "{{Ï€Î±ÏÎ¿Î¹Î¼Î¯Î±}",
    "{{Ï€Î±ÏÎ¿Î¹Î¼Î¯Î±|el}",
    "{{Ï€ÏÏŒÎ¸Î·Î¼Î±}",
    "{{Ï€ÏÏŒÎ¸Î·Î¼Î±|el}",
    "{{Î¼Î¿ÏÏ†Î® Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¿Ï}",
    "{{Î¼Î¿ÏÏ†Î® Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¿Ï|el}",
    "{{Î¼Î¿ÏÏ†Î® ÏÎ®Î¼Î±Ï„Î¿Ï‚}",
    "{{Î¼Î¿ÏÏ†Î® ÏÎ®Î¼Î±Ï„Î¿Ï‚|el}",
    "{{Î¼Î¿ÏÏ†Î® ÎµÏ€Î¹Î¸Î­Ï„Î¿Ï…}",
    "{{Î¼Î¿ÏÏ†Î® ÎµÏ€Î¹Î¸Î­Ï„Î¿Ï…|el}",
    "{{ÎµÎºÏ†ÏÎ¬ÏƒÎµÎ¹Ï‚}",
    "{{ÎµÎºÏ†ÏÎ¬ÏƒÎµÎ¹Ï‚|el}",
)

# Variants
variant_titles = sections
variant_templates = (
    "{{infl",
    "{{Î¸Î·Î» Ï„Î¿Ï…",
    "{{ÎºÎ»|",
    "{{Ï€Ï„ÏÏƒÎµÎ¹Ï‚ÎŸÎ‘ÎšÏ€Î»",
)

# Some definitions are not good to keep (plural, gender, ... )
definitions_to_ignore = (
    *variant_templates,
    "{{Î¼Î¿ÏÏ†Î® Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¿Ï",
    "{{Î¼Î¿ÏÏ†Î® ÏÎ®Î¼Î±Ï„Î¿Ï‚",
    "{{Î¼Î¿ÏÏ†Î® ÎµÏ€Î¹Î¸Î­Ï„Î¿Ï…}",
    "{{ÎµÎºÏ†ÏÎ¬ÏƒÎµÎ¹Ï‚",
)

# Templates to ignore: the text will be deleted.
templates_ignored = (
    "audio",
    "cat",
    "cf",
    "el-ÎºÎ»Î¯Ïƒ",
    "el-ÎºÎ»Î¯ÏƒÎ·-'Î½Î±ÏŒÏ‚'",
    "el-ÎºÎ»Î¯Ïƒ-'Î¼Î±Î½Î¬Î²Î·Ï‚'",
    "el-ÎºÎ»Î¯ÏƒÎ·-'Î³Î¹Î±Ï„ÏÏŒÏ‚'",
    "el-ÎºÎ»Î¯ÏƒÎ·-'ÏƒÎ¿Ï†Î¯Î±'",
    "el-ÎºÎ»Î¯ÏƒÎ·-'Ï€Î±Î¹Î´Î¯'",
    "el-ÎºÎ»Î¯ÏƒÎ·-'ÏŒÎ¼Î¿ÏÏ†Î¿Ï‚'",
    "el-ÎºÎ»Î¯Ïƒ-'Î½Î±ÏÏ„Î·Ï‚'",
    "el-ÎºÎ»Î¯Ïƒ-'Ï‰ÏÎ±Î¯Î¿Ï‚'",
    "!",
    "R:TELETERM",
    "ÎºÎ»ÎµÎ¯Î´Î±-ÎµÎ»Î»",
    "Î»ÎµÎ¯Ï€ÎµÎ¹ Î· ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±",
    "Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚",
    "Î±Ï€ÏŒ",
    "ÎµÏ„Ï…+",
    "Î»ÎµÎ¯Ï€ÎµÎ¹ Î¿ Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚",
    "Î’Î¹ÎºÎ¹Ï€Î±Î¯Î´ÎµÎ¹Î±",
    "Î»ÎµÎ¯Ï€ÎµÎ¹ Î· ÎºÎ»Î¯ÏƒÎ·",
    "Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï€Î±ÏÎ¬Î¸ÎµÎ¼Î±",
    "Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®",
    "Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·",
    "Î»ÎµÎ¯Ï€ÎµÎ¹ Î· Î¼ÎµÏ„Î¬Ï†ÏÎ±ÏƒÎ·",
    "clear",
    "Ï€Î¿Î»Ï…Ï„ Î³ÏÎ±Ï†Î®",
    "wlogo",
)

# Templates more complex to manage.
templates_multi: dict[str, str] = {
    # {{IPAchar|/ËˆsÉ›lÉ™teÉªp/}}
    "IPAchar": "parts[1]",
    # {{IPAstyle|ËˆÉ‘É¹.kÉ™n.sÉ”}}
    "IPAstyle": "parts[1]",
    # {{resize|Î’Î¹ÎºÎ¹Î»ÎµÎ¾Î¹ÎºÏŒ|140}}
    "resize": "f'<span style=\"font-size:{parts[2]}%;\">{parts[1]}</span>'",
    # {{uni-script|Î›VÎ›V}}
    "uni-script": "parts[1]",
    # {{ÎºÎ½Îµ}}
    "ÎºÎ½Îµ": "italic('ÎºÎ¿Î¹Î½Î® Î½ÎµÎ¿ÎµÎ»Î»Î·Î½Î¹ÎºÎ®')",
    # {{Î¹Îµ}}
    "Î¹Îµ": "italic('Ï€ÏÏ‰Ï„Î¿ÏŠÎ½Î´Î¿ÎµÏ…ÏÏ‰Ï€Î±ÏŠÎºÎ® ÏÎ¯Î¶Î±')",
    # {{Î½Îµ}}
    "Î½Îµ": "italic('Î½Î­Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®')",
    # {{Î¿Ï…Î´ Ï„Î¿Ï…|Î»Î­Î¾Î·}}
    "Î¿Ï…Î´ Ï„Î¿Ï…": "italic('Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ Ï„Î¿Ï…') + ' ' + strong(parts[1])",
    # {{Î±Î¹Ï„}}
    "Î±Î¹Ï„": "italic(strong('Î±Î¹Ï„Î¹Î±Ï„Î¹ÎºÎ®'))",
    # {{Î»2||Ï„Î¿Ï€Ï‰Î½ÏÎ¼Î¹Î¿|Ï„Î¿Ï€Ï‰Î½ÏÎ¼Î¹Î±}}
    "Î»2": "parts[-1]",
    # {{Î²|lang=fr|Motosacoche}}
    "Î²": "parts[-1]",
    # {{Î¸Î·Î» Î¹ÏƒÏƒÎ±|Î‘Î²Î±ÏÎ¹Ï„ÏƒÎ¹ÏÏ„Î·Ï‚|Î‘Î²Î±ÏÎ¹Ï„ÏƒÎ¹ÏÏ„(Î·Ï‚)}}
    "Î¸Î·Î» Î¹ÏƒÏƒÎ±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î¹ÏƒÏƒÎ±"',
    # {{Î¸Î·Î» Ï„ÏÎ¹Î±|Î´Î¹ÎµÏ…Î¸Ï…Î½Ï„Î®Ï‚|Î´Î¹ÎµÏ…Î¸Ï…Î½Ï„(Î®Ï‚)}}
    "Î¸Î·Î» Ï„ÏÎ¹Î±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Ï„ÏÎ¹Î±"',
    # {{Î¸Î·Î» Ï„ÏÎ±|ÏˆÎµÏÏ„Î·Ï‚|ÏˆÎµÏ(Ï„Î·Ï‚)}}
    "Î¸Î·Î» Ï„ÏÎ±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Ï„ÏÎ±"',
    # {{Î¸Î·Î» Î±|ÎšÎµÏÎºÏ…ÏÎ±Î¯Î¿Ï‚|ÎšÎµÏÎºÏ…ÏÎ±Î¯(Î¿Ï‚)}}
    "Î¸Î·Î» Î±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î±"',
    # {{Î¸Î·Î» Î¹ÏƒÏ„ÏÎ¹Î±|ÎµÎ³Ï‰Î¹ÏƒÏ„Î®Ï‚|ÎµÎ³Ï‰(Î¹ÏƒÏ„Î®Ï‚)}}
    "Î¸Î·Î» Î¹ÏƒÏ„ÏÎ¹Î±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î¯ÏƒÏ„ÏÎ¹Î±"',
    # {{Î¸Î·Î» Î¿Ï|Î¼ÎµÏÎ±ÎºÎ»Î®Ï‚|Î¼ÎµÏÎ±ÎºÎ»(Î®Ï‚)}}
    "Î¸Î·Î» Î¿Ï": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î¿Ï"',
    # {{Î¸Î·Î» Î¯Î½Î±|Î¼ÎµÏÎ±ÎºÎ»Î®Ï‚|Î¼ÎµÏÎ±ÎºÎ»(Î®Ï‚)}}
    "Î¸Î·Î» Î¯Î½Î±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î¯Î½Î±"',
    # {{Î¸Î·Î» Î¹Î´Î±|Ï€ÏÎ¿ÏƒÏ„Î¬Ï„Î·Ï‚|Ï€ÏÎ¿ÏƒÏ„Î¬Ï„(Î·Ï‚)}}
    "Î¸Î·Î» Î¹Î´Î±": 'f"{parts[-1]} + ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Î¸Î·Î»Ï…ÎºÎ¿Ï -Î¹Î´Î±"',
    # {{Ï…Ï€Î¿ÎºÎ¿ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï…|Ann}}
    # {{Ï…Ï€Î¿ÎºÎ¿ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï…|Ann|ÎºÎ±Ï„=-Î¬ÎºÎ¹}}
    "Ï…Ï€Î¿ÎºÎ¿ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï…": 'f"Ï…Ï€Î¿ÎºÎ¿ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï… {italic(parts[1])}"',
    # {{Î¿-Ï€Î»}}
    "Î¿-Ï€Î»": "italic('Î¿Ï…Î´Î­Ï„ÎµÏÎ¿ ÏƒÏ„Î¿Î½ Ï€Î»Î·Î¸Ï…Î½Ï„Î¹ÎºÏŒ')",
    # {{Î¿Ï€Î»}}
    "Î¿Ï€Î»": "italic('Î¿Ï…Î´Î­Ï„ÎµÏÎ¿, Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿Î½ Ï€Î»Î·Î¸Ï…Î½Ï„Î¹ÎºÏŒ')",
    # {{wsp|Eruca}}
    "wsp": "parts[-1]",
}
# Alias
templates_multi["Î¿Ï…Î´_Ï„Î¿Ï…"] = templates_multi["Î¿Ï…Î´ Ï„Î¿Ï…"]
templates_multi["Wspecies"] = templates_multi["wsp"]
templates_multi["Wikispecies"] = templates_multi["wsp"]

# Templates that will be completed/replaced using custom style.
templates_other = {
    "*": "*",
    "gag": "Î³ÎºÎ±Î³ÎºÎ±Î¿ÏÎ¶",
    "odt": "Ï€Î±Î»Î±Î¹Î¬ Î¿Î»Î»Î±Î½Î´Î¹ÎºÎ¬",
    "orv": "Î±ÏÏ‡Î±Î¯Î± Î±Î½Î±Ï„Î¿Î»Î¹ÎºÎ® ÏƒÎ»Î±Î²Î¹ÎºÎ® Î³Î»ÏÏƒÏƒÎ±",
    "osp": "Ï€Î±Î»Î±Î¹Î¬ Î¹ÏƒÏ€Î±Î½Î¹ÎºÎ®",
    "oty": "Î±ÏÏ‡Î±Î¯Î± Ï„Î±Î¼Î¯Î»",
    "Î»Î±ÏŠÎº": "(<i>Î»Î±ÏŠÎºÏŒÏ„ÏÎ¿Ï€Î¿</i>)",
}

# Release content on GitHub
# https://github.com/BoboTiG/ebook-reader-dict/releases/tag/el
release_description = """\
### ğŸŒŸ Î ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÏ„Î±Î¹ Ï„Î±ÎºÏ„Î¹ÎºÎ¬, Î±Ï…Ï„ÏŒ Ï„Î¿ Î­ÏÎ³Î¿ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·- [ÎºÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÎµÎ´Ï](https://github.com/BoboTiG/ebook-reader-dict/issues/2339) Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Î´Ï‰ÏÎµÎ¬. ğŸŒŸ

<br/>


Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î»Î­Î¾ÎµÏ‰Î½: {words_count}
Î•Î¾Î±Î³Ï‰Î³Î® Î’Î¹ÎºÎ¹Î»ÎµÎ¾Î¹ÎºÎ¿Ï: {dump_date}

Î Î»Î®ÏÎ·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·:
{download_links_full}

ÎˆÎºÎ´Î¿ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±:
{download_links_noetym}

<sub>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚: {creation_date}</sub>
"""

# Dictionary name that will be printed below each definition
wiktionary = "Î’Î¹ÎºÎ¹Î»ÎµÎ¾Î¹ÎºÏŒ (É”) {year}"


_genders = {
    "Î¸": "Î¸Î·Î»Ï…ÎºÏŒ",
    "Î±": "Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ",
    "Î±Î¸": "Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¸Î·Î»Ï…ÎºÏŒ",
    "Î±Î¸Î¿": "Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ, Î¸Î·Î»Ï…ÎºÏŒ, Î¿Ï…Î´Î­Ï„ÎµÏÎ¿",
    "Î±ÎºÎ»": "Î¬ÎºÎ»Î¹Ï„Î¿",
    "ÎºÎ±Î¸": "(ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±)",
    "Î¿": "Î¿Ï…Î´Î­Ï„ÎµÏÎ¿",
    "Î¸Î¿": "Î¸Î·Î»Ï…ÎºÏŒ Î® Î¿Ï…Î´Î­Ï„ÎµÏÎ¿",
    "Î±Î¿": "Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¿Ï…Î´Î­Ï„ÎµÏÎ¿",
    "Î±ÎºÏ": "Î±ÎºÏÏ‰Î½ÏÎ¼Î¹Î¿",
}


def find_genders(code: str, locale: str) -> list[str]:
    """
    >>> find_genders("", "el")
    []
    >>> find_genders("'''{{PAGENAME}}''' {{Î±Î¸}}", "el")
    ['Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¸Î·Î»Ï…ÎºÏŒ']
    >>> find_genders("'''{{PAGENAME}}''' {{Î±Î¸}}, {{Î±ÎºÎ»|Î±Î¸}}", "el")
    ['Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¸Î·Î»Ï…ÎºÏŒ', 'Î¬ÎºÎ»Î¹Ï„Î¿']
    >>> find_genders("'''{{PAGENAME}}''' {{Î±ÎºÎ»|Î±Î¸}}, {{Î±Î¸}}", "el")
    ['Î¬ÎºÎ»Î¹Ï„Î¿', 'Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¸Î·Î»Ï…ÎºÏŒ']
    >>> find_genders("'''{{PAGENAME}}''' {{Î¸Î¿}} {{Î±ÎºÎ»}}", "el")
    ['Î¸Î·Î»Ï…ÎºÏŒ Î® Î¿Ï…Î´Î­Ï„ÎµÏÎ¿', 'Î¬ÎºÎ»Î¹Ï„Î¿']
    >>> find_genders("'''{{PAGENAME}}''' {{Î±Î¿}} {{Î±ÎºÎ»}} {{Î±ÎºÏ}}", "el")
    ['Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¿Ï…Î´Î­Ï„ÎµÏÎ¿', 'Î¬ÎºÎ»Î¹Ï„Î¿', 'Î±ÎºÏÏ‰Î½ÏÎ¼Î¹Î¿']
    >>> find_genders("'''{{PAGENAME}}''' {{Î±}} ({{ÎµÏ„|Î¹Î´Î¹Ï‰Î¼Î±Ï„Î¹ÎºÏŒ|0=-}}, ÎšÎ¬Î»Ï…Î¼Î½Î¿Ï‚)", "el")
    ['Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ']
    """
    pattern = re.compile(r"{{([^{}]*)}}")
    line_pattern = "'''{{PAGENAME}}''' "
    return [
        g
        for line in code.splitlines()
        for gender in pattern.findall(line[len(line_pattern) :])
        if line.startswith(line_pattern) and (g := _genders.get(gender.split("|")[0]))
    ]


def find_pronunciations(code: str, locale: str) -> list[str]:
    """
    >>> find_pronunciations("", "el")
    []
    >>> find_pronunciations("{{Î”Î¦Î‘|tÉ¾eËˆlos|Î³Î»=el}}", "el")
    ['/tÉ¾eËˆlos/']
    >>> find_pronunciations("{{Î”Î¦Î‘|Î³Î»=el|Ëˆni.xta}}", "el")
    ['/Ëˆni.xta/']
    >>> find_pronunciations("{{Î”Î¦Î‘|el|Ëˆni.Ã°i.mos}}", "el")
    ['/Ëˆni.Ã°i.mos/']
    """
    pattern = re.compile(rf"\{{Î”Î¦Î‘(?:\|Î³Î»={locale})?(?:\|{locale})?\|([^}}\|]+)")
    return [f"/{p}/" for p in unique(pattern.findall(code))]


def text_language(lang_iso: str, *, args: dict[str, str] = defaultdict(str)) -> str:
    """
    see https://el.wiktionary.org/w/index.php?title=Module:%CE%B5%CF%84%CF%85%CE%BC%CE%BF%CE%BB%CE%BF%CE%B3%CE%AF%CE%B1&oldid=6368956 link_language function
    """
    lang: dict[str, str | bool] = langs[lang_iso]
    lang_name = str(lang["name"])  # neuter plural Î³Î±Î»Î»Î¹ÎºÎ¬ (or fem.sing. Î¼Î­ÏƒÎ· Î³ÎµÏÎ¼Î±Î½ÎºÎ®)
    lang_frm = str(lang["frm"])  # feminine accusative singular Î³Î±Î»Î»Î¹ÎºÎ®
    text = ""
    if lang_name and lang_frm:
        # feminine article + accusative singular Ï„Î· Î³Î±Î»Î»Î¹ÎºÎ®
        lang_donor_apo = str(lang["apo"])
        # Ï€ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·Ï‚ Î±Ï€ÏŒ +apota -- FOR FAMILIES: ÏƒÎ·Î¼Î¹Ï„Î¹ÎºÎ®Ï‚ Ï€ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·Ï‚
        lang_donor_from = str(lang["from"])
        if args["root"] == "1" or args["ÏÎ¯Î¶Î±"] == "1":
            text = f"{italic(lang_frm)} <i>ÏÎ¯Î¶Î±</i>"
        elif lang["family"]:
            text = italic(lang_donor_from)
        elif args["text"] == "1" or args["ÎºÎµÎ¹Î¼"] == "1":
            text = italic(lang_donor_apo)
        else:
            text = italic(lang_frm)

    return text


def labels_output(text_in: str, *, args: dict[str, str] = defaultdict(str)) -> str:
    """
    from https://el.wiktionary.org/w/index.php?title=Module:labels&oldid=5634715
    """
    from .labels import labels as data

    mytext = ""

    label = args.get("label") or args.get("topic") or args.get("ÎµÏ„Î¹ÎºÎ­Ï„Î±") or ""

    alias = ""
    if label in aliases:
        alias = label
        label = aliases[alias]

    text = text_in or args["1"]
    term = args["ÏŒÏÎ¿Ï‚"] or args["term"] or ""
    show = args["ÎµÎ¼Ï†"] or args["show"] or ""
    noparenthesis = args["0"]
    if not label or label is None:
        return ""
    nodisplay = args["nodisplay"] or args["000"]

    if not nodisplay:
        if term != "":
            mytext = term
        elif text != "":
            mytext = text
        elif all_labels := data.get(label):
            if isinstance(all_labels, list):
                all_labels = all_labels[0]
            if all_labels.get("link") not in {None, "Ï€Î±Ï„ÏÏŒÏ„Î·Ï„Î±"}:
                mytext = show or f"{italic(all_labels['linkshow'])}"
        mytext = mytext if noparenthesis else f"({mytext})"
    return mytext


def last_template_handler(
    template: tuple[str, ...],
    locale: str,
    *,
    word: str = "",
    all_templates: list[tuple[str, str, str]] | None = None,
) -> str:
    """
    Will be call in utils.py::transform() when all template handlers were not used.

        >>> last_template_handler(["Î³ÏÎ±Ï€Ï„Î·ÎµÎ¼Ï†", "1889"], "el")
        '<i>(Î· Î»Î­Î¾Î· Î¼Î±ÏÏ„Ï…ÏÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ 1889)</i>'
        >>> last_template_handler(["Î³ÏÎ±Ï€Ï„Î·ÎµÎ¼Ï†", "1889", "0=-"], "el")
        'Î· Î»Î­Î¾Î· Î¼Î±ÏÏ„Ï…ÏÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ 1889'

        >>> last_template_handler(["Î»ÎµÎ½Î´", "el", "fr"], "el")
        'Î»ÏŒÎ³Î¹Î¿ ÎµÎ½Î´Î¿Î³ÎµÎ½Î­Ï‚ Î´Î¬Î½ÎµÎ¹Î¿:'
        >>> last_template_handler(["Î»ÎµÎ½Î´", "el", "fr", "0=-"], "el")
        'Î»ÏŒÎ³Î¹Î¿ ÎµÎ½Î´Î¿Î³ÎµÎ½Î­Ï‚ Î´Î¬Î½ÎµÎ¹Î¿'

        >>> last_template_handler(["Î»Î´Î´", "grc", "el", "Î½Î®Î´Ï…Î¼Î¿Ï‚"], "el")
        '(Î´Î¹Î±Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¬Î½ÎµÎ¹Î¿) <i>Î±ÏÏ‡Î±Î¯Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i> Î½Î®Î´Ï…Î¼Î¿Ï‚'
        >>> last_template_handler(["Î»Î´Î´", "grc-koi", "el"], "el")
        '(Î´Î¹Î±Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¬Î½ÎµÎ¹Î¿) <i>ÎµÎ»Î»Î·Î½Î¹ÏƒÏ„Î¹ÎºÎ® ÎºÎ¿Î¹Î½Î®</i>'
        >>> last_template_handler(["Î»Î´Î´", "0=-", "grc-koi", "el", "Ï„ÎµÏ‡Î½Î¹ÎºÏŒÏ‚"], "el")
        '<i>ÎµÎ»Î»Î·Î½Î¹ÏƒÏ„Î¹ÎºÎ® ÎºÎ¿Î¹Î½Î®</i> Ï„ÎµÏ‡Î½Î¹ÎºÏŒÏ‚'
        >>> last_template_handler(["Î»Î´Î´", "kath", "el", "Î±á¼°Ï„Î¹ÏŒÏ„Î·Ï‚", "Î±á¼°Ï„Î¹(ÏŒÏ„Î·Ï‚)"], "el")
        '(Î´Î¹Î±Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¬Î½ÎµÎ¹Î¿) <i>ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±</i> Î±á¼°Ï„Î¹(ÏŒÏ„Î·Ï‚)'

        >>> last_template_handler(["Î»", "á¼¡Î´ÏÏ‚", "grc"], "el")
        'á¼¡Î´ÏÏ‚'
        >>> last_template_handler(["Î»"], "el", word="Î™Î½Î´Î¯Î±")
        'Î™Î½Î´Î¯Î±'
        >>> last_template_handler(["l", "Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²Ğ¾", "ru", "lang=4", "tnl=Î™Î²Î¬Î½Î¿Î²Î¿ -Ï„Î¿Ï… Î™Î²Î¬Î½-, Ï€ÏŒÎ»Î· Ï„Î·Ï‚ Î¡Ï‰ÏƒÎ¯Î±Ï‚"], "el")
        '<i>ÏÏ‰ÏƒÎ¹ÎºÎ®</i> Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²Ğ¾ (Î™Î²Î¬Î½Î¿Î²Î¿ -Ï„Î¿Ï… Î™Î²Î¬Î½-, Ï€ÏŒÎ»Î· Ï„Î·Ï‚ Î¡Ï‰ÏƒÎ¯Î±Ï‚)'
        >>> last_template_handler(["l", "acur", "tr=", "lang=4"], "el")
        '<i>Î½Î­Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i> acur'

        >>> last_template_handler(["ÎµÏ„"], "el")
        ''
        >>> last_template_handler(["ÎµÏ„", "Î¹Î±Ï„ÏÎ¹ÎºÎ®"], "el")
        '(<i>Î¹Î±Ï„ÏÎ¹ÎºÎ®</i>)'
        >>> last_template_handler(["ÎµÏ„", "Î¹Î±Ï„ÏÎ¹ÎºÎ®", "0=-"], "el")
        '<i>Î¹Î±Ï„ÏÎ¹ÎºÎ®</i>'
        >>> last_template_handler(["ÎµÏ„", "Î¹Î±Ï„ÏÎ¹ÎºÎ®", "en"], "el")
        '<i>Î¹Î±Ï„ÏÎ¹ÎºÎ®</i>'
        >>> last_template_handler(["ÎµÏ„", "Î¹Î±Ï„ÏÎ¹ÎºÎ®", "", "Î¹Î±Ï„ÏÎ¹ÎºÏÎ½ ÏŒÏÏ‰Î½", "0=-"], "el")
        'Î¹Î±Ï„ÏÎ¹ÎºÏÎ½ ÏŒÏÏ‰Î½'

        >>> last_template_handler(["Î»ÏŒÎ³Î¹Î¿"], "el")
        '(<i>Î»ÏŒÎ³Î¹Î¿</i>)'

        >>> last_template_handler(["Î¿Ï…Ïƒ"], "el")
        '<i>(Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿)</i>'

        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "ine-pro"], "el")
        '<i>Ï€ÏÏ‰Ï„Î¿ÏŠÎ½Î´Î¿ÎµÏ…ÏÏ‰Ï€Î±ÏŠÎºÎ®</i>'
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "gkm"], "el")
        '<i>Î¼ÎµÏƒÎ±Î¹Ï‰Î½Î¹ÎºÎ® ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i>'
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "Î¼ÏƒÎ½"], "el")
        '<i>Î¼ÎµÏƒÎ±Î¹Ï‰Î½Î¹ÎºÎ® ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i>'
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "grc", "el", "á¼”Î»Î±Î¹Î¿Î½"], "el")
        '<i>Î±ÏÏ‡Î±Î¯Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i> á¼”Î»Î±Î¹Î¿Î½'
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "sla"], "el")
        '<i>ÏƒÎ»Î±Î²Î¹ÎºÎ®Ï‚ Ï€ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·Ï‚</i>'
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "yua"], "el")
        ''
        >>> last_template_handler(["ÎµÏ„Ï…Î¼", "ar", "el", "Ø¢Ø¬ÙØ±Ù‘", "tr=Ê¾Äjurr"], "el")
        '<i>Î±ÏÎ±Î²Î¹ÎºÎ®</i> Ø¢Ø¬ÙØ±Ù‘ (Ê¾Äjurr)'

        >>> last_template_handler(["Î³Ï", "Ï„ÏÎ±Ï€ÎµÎ¶Î¿Î¼Î¬Î½Ï„Î¹Î»Î¿"], "el")
        '<i>Î¬Î»Î»Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…</i> <b>Ï„ÏÎ±Ï€ÎµÎ¶Î¿Î¼Î¬Î½Ï„Î¹Î»Î¿</b>'
        >>> last_template_handler(["Î³Ï", "ÎµÎ»Î±Î¹ÏŒÎ´ÎµÎ½Î´ÏÎ¿", "Î¼Î¿ÏÏ†Î®"], "el")
        '<i>Î¬Î»Î»Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…</i> <b>ÎµÎ»Î±Î¹ÏŒÎ´ÎµÎ½Î´ÏÎ¿</b>'
        >>> last_template_handler(["Î³Ï", "ÎµÎ»Î±Î¹ÏŒÎ´ÎµÎ½Î´ÏÎ¿", "Ï€Î¿Î»Ï…", "ÎµÎ¼Ï†=ÎµÎ»Î±Î¹ÏŒÎ´ÎµÎ½Î´ÏÎ¿(Î½)"], "el")
        '<i>Ï€Î¿Î»Ï…Ï„Î¿Î½Î¹ÎºÎ® Î³ÏÎ±Ï†Î® Ï„Î¿Ï…</i> <b>ÎµÎ»Î±Î¹ÏŒÎ´ÎµÎ½Î´ÏÎ¿(Î½)</b>'
        >>> last_template_handler(["Î³Ï", "Ï€Î¿Î¹Î­Ï‰", "Î±ÏƒÏ…Î½", "grc"], "el")
        '<i>Î±ÏƒÏ…Î½Î±Î¯ÏÎµÏ„Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…</i> <b>Ï€Î¿Î¹Î­Ï‰</b>'
        >>> last_template_handler(["Î³Ï", "Ï€Î¿Î¹Î­Ï‰", "Î±ÏƒÏ…Î½", "grc", "ÎµÎ¼Ï†=Ï€Î¿Î¹-Î­Ï‰"], "el")
        '<i>Î±ÏƒÏ…Î½Î±Î¯ÏÎµÏ„Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…</i> <b>Ï€Î¿Î¹-Î­Ï‰</b>'
        >>> last_template_handler(["Î³Ï", "colour", "", "en"], "el")
        '<i>Î¬Î»Î»Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…</i> <b>colour</b>'
        >>> last_template_handler(["Î³Ï", "colour", "freestyle text", "en"], "el")
        '<i>freestyle text</i> <b>colour</b>'

        >>> last_template_handler(["Ï€ÏÏŒÏƒÏ†", "Î¼Î±Î»Î»Î¯", "-Î·Ï‚"], "el")
        'Î¼Î±Î»Î»Î¯ + -Î·Ï‚'
        >>> last_template_handler(["Ï€ÏÏŒÏƒÏ†", "Î¼Î±Î»Î»Î¯", ".1=Î¼Î±Î»Î»(Î¯)", "-Î·Ï‚"], "el")
        'Î¼Î±Î»Î»(Î¯) + -Î·Ï‚'

        >>> last_template_handler(["Î±ÏÏ‡"], "el")
        '<i>Î±ÏÏ‡Î±Î¯Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i>'
        >>> last_template_handler(["Î±ÏÏ‡", "á½…Ï€Î¿Ï…"], "el")
        '<i>Î±ÏÏ‡Î±Î¯Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i> á½…Ï€Î¿Ï…'

        >>> last_template_handler(["Î¼ÏƒÎ½"], "el")
        '<i>Î¼ÎµÏƒÎ±Î¹Ï‰Î½Î¹ÎºÎ® ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i>'
        >>> last_template_handler(["Î¼ÏƒÎ½", "á½…Ï€Î¿Ï…"], "el")
        '<i>Î¼ÎµÏƒÎ±Î¹Ï‰Î½Î¹ÎºÎ® ÎµÎ»Î»Î·Î½Î¹ÎºÎ®</i> á½…Ï€Î¿Ï…'

        >>> last_template_handler(["fr"], "el")
        'Î³Î±Î»Î»Î¹ÎºÎ¬'

        >>> last_template_handler(["Î³ÏÎ±Ï†Î® Ï„Î¿Ï…", "Î¬ÏƒÎ¿Ï‚"], "el")
        '<i>Î¬Î»Î»Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…</i> <b>Î¬ÏƒÎ¿Ï‚</b>'
        >>> last_template_handler(["Î³ÏÎ±Ï†Î® Ï„Î¿Ï…", "Î±Î³Î¬Ï", "Î¼Î¿ÏÏ†"], "el")
        '<i>Î¬Î»Î»Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…</i> <b>Î±Î³Î¬Ï</b>'

        >>> last_template_handler(["ÎµÏ„Î¹Îº", "Î³Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¯Î±", "Ï„ÏÏŒÏ†Î¹Î¼Î±", "Î³Î»Ï…ÎºÎ¬"], "el")
        '(<i>Î³Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¯Î±</i>, <i>Ï„ÏÏŒÏ†Î¹Î¼Î±</i>, <i>Î³Î»Ï…ÎºÏŒ</i>)'
        >>> last_template_handler(["ÎµÏ„Î¹Îº", "Î²Î¹Î¿Î»", "Î¹Î±Ï„Ï"], "el")
        '(<i>Î²Î¹Î¿Î»Î¿Î³Î¯Î±</i>, <i>Î¹Î±Ï„ÏÎ¹ÎºÎ®</i>)'

        >>> last_template_handler(["desc", "el", "Ï€Î¬ÏÏ„Î¹", "Î´Î±Î½"], "el")
        'â†· <i>Î½Î­Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬:</i> Ï€Î¬ÏÏ„Î¹'
        >>> last_template_handler(["Î±Ï€ÏŒÎ³", "el", "Ï€Î¬ÏÏ„Î¹", "Î´Î±Î½"], "el")
        'â†· <i>Î½Î­Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬:</i> Ï€Î¬ÏÏ„Î¹'
        >>> last_template_handler(["Î±Ï€ÏŒÎ³", "ÏƒÏÎ¼Î²Î¿Î»Î¿=Î´Î±Î½"], "el")
        'â†·'

        #
        # Variants
        #
        >>> last_template_handler(["infl", "grc", "Îµ=Î±Ï€Ï", "Ï‡=ÎµÎ½Îµ", "Î³Î¯Î³Î½Î¿Î¼Î±Î¹"], "el")
        'Î³Î¯Î³Î½Î¿Î¼Î±Î¹'
        >>> last_template_handler(["Î¸Î·Î» Ï„Î¿Ï…", "Î»Î­Î¾Î·"], "el")
        'Î»Î­Î¾Î·'
        >>> last_template_handler(["Î¸Î·Î» Ï„Î¿Ï…-Ï€Ï„ÏÏƒÎµÎ¹Ï‚ÎŸÎ‘ÎšÎµÎ½", "Î³ÎºÎ±Î½Ï„Î­Î¼Î·Ï‚"], "el")
        'Î³ÎºÎ±Î½Ï„Î­Î¼Î·Ï‚'
        >>> last_template_handler(["ÎºÎ»", "", "ÏƒÏ‡Î¿Î»ÎµÎ¯Î¿", "Ï€=Î³", "Î±=Ï€"], "el")
        'ÏƒÏ‡Î¿Î»ÎµÎ¯Î¿'
        >>> last_template_handler(["Ï€Ï„ÏÏƒÎµÎ¹Ï‚ÎŸÎ‘ÎšÏ€Î»", "", "ÏƒÏ‡Î¿Î»ÎµÎ¯Î¿", "Ï€=Î³", "Î±=Ï€"], "el")
        'ÏƒÏ‡Î¿Î»ÎµÎ¯Î¿'
    """
    from ...user_functions import concat, extract_keywords_from, italic, strong, term
    from .. import defaults
    from .template_handlers import lookup_template, render_template

    if lookup_template(template[0]):
        return render_template(word, template)

    tpl, *parts = template
    data = extract_keywords_from(parts)

    if tpl == "Î³ÏÎ±Ï†Î® Ï„Î¿Ï…":
        if len(parts) == 1:
            parts.append("Î³ÏÎ±Ï†")
        return f"{italic(f'Î¬Î»Î»Î· {parts[1]}Î® Ï„Î¿Ï…')} {strong(parts[0])}"

    if tpl in {"Î»Î´Î´", "dlbor"}:
        phrase = "" if data["0"] else "(Î´Î¹Î±Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¬Î½ÎµÎ¹Î¿) "
        phrase += text_language(parts[0], args=data)
        if rest := data["1"] or parts[-1] if len(parts) > 2 else "":
            phrase += f" {rest}"
        return phrase

    if tpl in {"Î»", "l", "link"}:
        text = ""
        if data["lang"]:
            text += f"{text_language(parts[1]) if len(parts) > 1 else italic('Î½Î­Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®')} "
        text += parts[0] if parts else word
        if tnl := data["tnl"]:
            text += f" ({tnl})"
        return text

    if tpl in {"Î±Ï€ÏŒÎ³", "desc"}:
        text = "â†·"
        if data["ÏƒÏÎ¼Î²Î¿Î»Î¿"] == "Î´Î±Î½":
            return text
        text += f" {italic(str(langs[parts[0]]['name']) + ':')} {parts[1]}"
        return text

    if tpl in {"ÎµÏ„", "ÎµÏ„Î¹ÎºÎ­Ï„Î±"}:
        if not parts:
            return ""
        if len(parts) <= 2:
            data["label"] = parts[0]
        else:
            data["label"] = parts[2]
            data["text"] = parts[2]

        # No parenthesis when more than one part (non-Greek words)
        if len(parts) > 1 and "0" not in data:
            data["0"] = "-"

        return labels_output(data.get("text", ""), args=data)

    if tpl == "ÎµÏ„Î¹Îº":
        return f"({', '.join(italic(aliases.get(part, part)) for part in parts)})"

    if tpl == "ÎµÏ„Ï…Î¼":
        text = text_language(parts[0])
        if len(parts) > 2:
            text += f" {parts[2]}"
        if tr := data["tr"]:
            text += f" ({tr})"
        return text

    if tpl == "Î»ÏŒÎ³Î¹Î¿":
        data["label"] = tpl
        return labels_output("", args=data)

    if text := {
        "Î»ÎµÎ½Î´": "Î»ÏŒÎ³Î¹Î¿ ÎµÎ½Î´Î¿Î³ÎµÎ½Î­Ï‚ Î´Î¬Î½ÎµÎ¹Î¿",
        "Î²Î»Ï†Ï": "Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ Î­ÎºÏ†ÏÎ±ÏƒÎ·",
    }.get(tpl, ""):
        if not data["0"]:
            text += ":"
        return text

    if text := {
        "Î±ÏÏ‡": "Î±ÏÏ‡Î±Î¯Î± ÎµÎ»Î»Î·Î½Î¹ÎºÎ®",
        "Î¼ÏƒÎ½": "Î¼ÎµÏƒÎ±Î¹Ï‰Î½Î¹ÎºÎ® ÎµÎ»Î»Î·Î½Î¹ÎºÎ®",
    }.get(tpl, ""):
        phrase = italic(text)
        if parts:
            phrase += f" {parts[0]}"
        return phrase

    if text := {
        "Î³ÏÎ±Ï€Ï„Î·ÎµÎ¼Ï†": f"Î· Î»Î­Î¾Î· Î¼Î±ÏÏ„Ï…ÏÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ {parts[0] if parts else ''}",
        "Î¼Ï„Ï†Ï": "Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬",
        "ÎºÏ„ÎµÏ€Îµ": "ÎºÎ±Ï„Ê¼ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·",
        "Î¼Ï„Î²": "Î¼ÎµÏ„Î±Î²Î±Ï„Î¹ÎºÏŒ",
        "Î±Î¼Ï„Î²": "Î±Î¼ÎµÏ„Î¬Î²Î±Ï„Î¿",
        "Î¿Ï…Ïƒ": "Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿",
        "Î½ÎµÎ¿Î»": "Î½ÎµÎ¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚",
        "Î¼Ï€Ï†": "Î¼Î­ÏƒÎ·-Ï€Î±Î¸Î·Ï„Î¹ÎºÎ® Ï†Ï‰Î½Î® Ï„Î¿Ï… ÏÎ®Î¼Î±Ï„Î¿Ï‚",
        "Î¼Ï„Î²+Î±Î¼Ï„Î²": "Î¼ÎµÏ„Î±Î²Î±Ï„Î¹ÎºÏŒ ÎºÎ±Î¹ Î±Î¼ÎµÏ„Î¬Î²Î±Ï„Î¿",
        "Î¼Ï„Î³Î½": "ÎµÎ»Î»Î·Î½Î¹ÏƒÏ„Î¹ÎºÎ®",
        "Î¼Ï„Î³Ï": "Î¼ÎµÏ„Î±Î³ÏÎ±Ï†Î®",
        "Î¼Ï„Ï‡Î±": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Î±Î¿ÏÎ¯ÏƒÏ„Î¿Ï…",
        "Î¼Ï„Ï‡Ï€Î±": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Î±Î¿ÏÎ¯ÏƒÏ„Î¿Ï…",
        "Î¼Ï„Ï‡Îµ": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï ÎµÎ½ÎµÏƒÏ„ÏÏ„Î±",
        "Î¼Ï„Ï‡Ï€Îµ": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï ÎµÎ½ÎµÏƒÏ„ÏÏ„Î±",
        "Î¼Ï„Ï‡ÎµÎ±": "Î¼ÎµÏ„Î¿Ï‡Î® ÎµÎ½ÎµÏÎ³Î·Ï„Î¹ÎºÎ¿Ï Î±Î¿ÏÎ¯ÏƒÏ„Î¿Ï…",
        "Î¼Ï„Ï‡ÎµÎµ": "Î¼ÎµÏ„Î¿Ï‡Î® ÎµÎ½ÎµÏÎ³Î·Ï„Î¹ÎºÎ¿Ï ÎµÎ½ÎµÏƒÏ„ÏÏ„Î±",
        "Î¼Ï„Ï‡ÎµÎ¼": "Î¼ÎµÏ„Î¿Ï‡Î® ÎµÎ½ÎµÏÎ³Î·Ï„Î¹ÎºÎ¿Ï Î¼Î­Î»Î»Î¿Î½Ï„Î±",
        "Î¼Ï„Ï‡ÎµÏ€": "Î¼ÎµÏ„Î¿Ï‡Î® ÎµÎ½ÎµÏÎ³Î·Ï„Î¹ÎºÎ¿Ï Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï„Ï‡Î¼Î±": "Î¼ÎµÏ„Î¿Ï‡Î® Î¼Î­ÏƒÎ¿Ï… Î±Î¿ÏÎ¯ÏƒÏ„Î¿Ï…",
        "Î¼Ï„Ï‡Ï€": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï„Ï‡Ï€Î¼": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Î¼Î­Î»Î»Î¿Î½Ï„Î±",
        "Î¼Ï„Ï‡Ï€p": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï„Ï‡Ï€Ï€": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï„Ï‡Ï€Ï€Î±Î½Î±Î´": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï„Ï‡Ï‡Ï": "Î¼ÎµÏ„Î¿Ï‡Î® Ï€Î±Î¸Î·Ï„Î¹ÎºÎ¿Ï Ï€Î±ÏÎ±ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…",
        "Î¼Ï…Î¸Î¿Î»": "Î¼Ï…Î¸Î¿Î»Î¿Î³Î¯Î±",
        "Ï€Î±ÏÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±": "Ï€Î±ÏÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±",
        "ÏƒÏ…Î½Î·Î¸": "Ï€Î¹Î¿ ÏƒÏ…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î¿",
        "ÏƒÏ€Î±Î½": "ÏƒÏ€Î¬Î½Î¹Î¿",
        "ÏƒÏ€Î¬Î½": "ÏƒÏ€Î¬Î½Î¹Î¿",
        "ÎºÎ±Ï„Î±Ï‡Ï": "ÎºÎ±Ï„Î±Ï‡ÏÎ·ÏƒÏ„Î¹ÎºÎ¬",
        "ÏƒÎ½ÎºÎ´": "ÏƒÏ…Î½ÎµÎºÎ´Î¿Ï‡Î¹ÎºÎ¬",
        "Î¼ÎµÎ¹Ï‰Ï„": "Î¼ÎµÎ¹Ï‰Ï„Î¹ÎºÏŒ",
        "Î¿ÏÎ¸Î¿Î´": "Î¿ÏÎ¸Î¿Î´Î¿Î¾Î¯Î±",
        "Î¸ÏÎ·ÏƒÎºÎµÎ¯Î±": "Î¸ÏÎ·ÏƒÎºÎµÎ¯Î±",
        "Ï‡Ï…Î´Î±Î¯Î¿": "Ï‡Ï…Î´Î±Î¯Î¿",
        "Î»Î±ÏŠÎºÏŒÏ„ÏÎ¿Ï€Î¿": "Î»Î±ÏŠÎºÏŒÏ„ÏÎ¿Ï€Î¿",
        "Î¿ÎµÎ½": "Î¿Ï…Î´Î­Ï„ÎµÏÎ¿",
        "Î¿Î¹Îº": "Î¿Î¹ÎºÎµÎ¯Î¿",
        "Î±Ï€ÏÏŒÏƒÏ‰Ï€Î¿": "Î±Ï€ÏÏŒÏƒÏ‰Ï€Î¿",
        "Î±ÏÎ³Îº": "Î±ÏÎ³ÎºÏŒ",
        "Î±ÏÎ³ÎºÏŒ": "Î±ÏÎ³ÎºÏŒ",
        "Ï€Î±ÏÏ‰Ï‡": "Ï€Î±ÏÏ‰Ï‡Î·Î¼Î­Î½Î¿",
        "ÎµÎ¹Î´Î¹Îº": "ÎµÎ¹Î´Î¹ÎºÏŒÏ„ÎµÏÎ±",
        "ÎµÎ¹Î´Î¹ÎºÏŒÏ„ÎµÏÎ±": "ÎµÎ¹Î´Î¹ÎºÏŒÏ„ÎµÏÎ±",
        "ÎµÎ¹ÏÏ‰Î½": "ÎµÎ¹ÏÏ‰Î½Î¹ÎºÏŒ",
        "ÎµÎ¹ÏÏ‰Î½Î¹ÎºÎ¬": "ÎµÎ¹ÏÏ‰Î½Î¹ÎºÏŒ",
        "ÎµÎ¹ÏÏ‰Î½Î¹ÎºÏŒ": "ÎµÎ¹ÏÏ‰Î½Î¹ÎºÏŒ",
        "ÎºÏ…ÏÎ¹Î¿Î»": "ÎºÏ…ÏÎ¹Î¿Î»ÎµÎºÏ„Î¹ÎºÎ¬",
        "ÎºÏ…ÏÎ¹Î¿Î»+Î¼Ï„Ï†Ï": "ÎºÏ…ÏÎ¹Î¿Î»ÎµÎºÏ„Î¹ÎºÎ¬ ÎºÎ±Î¹ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬",
        "ÎµÏ„Ï…Î¼ en": "Î±Î³Î³Î»Î¹ÎºÎ®",
        "ÎµÏ„Ï…Î¼ fr": "Î³Î±Î»Î»Î¹ÎºÎ®",
        "ÎµÏ„Ï…Î¼_en": "Î±Î³Î³Î»Î¹ÎºÎ®",
        "ÎµÏ„Ï…Î¼_fr": "Î³Î±Î»Î»Î¹ÎºÎ®",
        "ÎºÏ…ÏÎ¹Î¿Î»ÎµÎºÏ„Î¹ÎºÎ¬": "ÎºÏ…ÏÎ¹Î¿Î»ÎµÎºÏ„Î¹ÎºÎ¬",
        "ÎºÎ±Î¸ ÎºÎ¿Î¹Î½Î®": "ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±",
        "ÎºÎ±Î¸ Î¼ÎµÏƒ": "ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±",
        "ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±": "ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±",
        "ÎºÎ±Ï„' ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·": "ÎºÎ±Ï„' ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·",
        "Î³ÎµÎ½Î¹ÎºÏŒÏ„ÎµÏÎ±": "Î³ÎµÎ½Î¹ÎºÏŒÏ„ÎµÏÎ±",
        "Î±ÏÏ‡Î±Î¹Î¿Ï€ÏÎµÏ€Î­Ï‚": "Î±ÏÏ‡Î±Î¹Î¿Ï€ÏÎµÏ€Î­Ï‚",
        "Î´Î·Î¼Î¿Ï„Î¹ÎºÎ®": "Î´Î·Î¼Î¿Ï„Î¹ÎºÎ®",
        "Î´Î¿Ï„Î¹ÎºÎ®": "Î´Î¿Ï„Î¹ÎºÎ®",
        "ÎµÏ€Ï„Î±Î½Î·ÏƒÎ¹Î±ÎºÎ¬": "ÎµÏ€Ï„Î±Î½Î·ÏƒÎ¹Î±ÎºÎ¬",
        "ÎµÏ€ÏÎ½Ï…Î¼Î¿": "ÎµÏ€ÏÎ½Ï…Î¼Î¿",
        "ÎºÎ±Ï„Î±Ï‡ÏÎ·ÏƒÏ„Î¹ÎºÎ¬": "ÎºÎ±Ï„Î±Ï‡ÏÎ·ÏƒÏ„Î¹ÎºÎ¬",
        "ÎºÎµÏ†Î±Î»Î¿Î½Î¯Ï„Î¹ÎºÎ±": "ÎºÎµÏ†Î±Î»Î¿Î½Î¯Ï„Î¹ÎºÎ±",
        "ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±": "ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¯Î±",
        "ÏƒÏ€Î¬Î½Î¹Î¿": "ÏƒÏ€Î¬Î½Î¹Î¿",
        "ÏƒÏ…Î³Î³ÎµÎ½Î®": "ÏƒÏ…Î³Î³ÎµÎ½Î®",
        "ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ ÏƒÏ…Î½Ï„Î±ÎºÏ„ÏÎ½": "ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ ÏƒÏ…Î½Ï„Î±ÎºÏ„ÏÎ½",
        "ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚": "ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚",
        "ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·": "ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·",
        "Ï€ÏÎ¿ÏƒÏ†ÏÎ½Î·ÏƒÎ·": "Ï€ÏÎ¿ÏƒÏ†ÏÎ½Î·ÏƒÎ·",
        "Ï€ÏÎ¿ÏƒÏ‡Î­Î´Î¹Î¿": "Ï€ÏÎ¿ÏƒÏ‡Î­Î´Î¹Î¿",
        "Ï€ÏÎ¿Ï†Î¿ÏÎ¹ÎºÏŒ": "Ï€ÏÎ¿Ï†Î¿ÏÎ¹ÎºÏŒ",
        "Î¼ÎµÏ„Î±Î²Î±Ï„Î¹ÎºÏŒ": "Î¼ÎµÏ„Î±Î²Î±Ï„Î¹ÎºÏŒ",
        "Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬": "Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¹ÎºÎ¬",
        "Î¼Î¿ÏÏ†Î¿Î»Î¿Î³Î¹ÎºÎ¬": "Î¼Î¿ÏÏ†Î¿Î»Î¿Î³Î¹ÎºÎ¬",
        "Î½ÎµÎ¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚": "Î½ÎµÎ¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚",
        "Î¿Î¹ÎºÎµÎ¯Î¿": "Î¿Î¹ÎºÎµÎ¯Î¿",
        "ÏŒÎ½Î¿Î¼Î±": "ÏŒÎ½Î¿Î¼Î±",
        "Ï€Î±Î¹Î´Î¹Î¬": "Ï€Î±Î¹Î´Î¹Î¬",
        "Ï€Î±ÏÎ¬Î¸ÎµÎ¼Î±": "Ï€Î±ÏÎ¬Î¸ÎµÎ¼Î±",
        "Ï€Î±ÏÏ‰Ï‡Î·Î¼Î­Î½Î¿": "Ï€Î±ÏÏ‰Ï‡Î·Î¼Î­Î½Î¿",
        "Î±ÏÏ‡Î±Î¹Î¿Ï€Ï": "Î±ÏÏ‡Î±Î¹Î¿Ï€ÏÎµÏ€Î­Ï‚",
        "Î±Ï„Ï„": "Î±Ï„Ï„Î¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚",
        "ÏƒÏ…Î½ÎµÎºÎ´Î¿Ï‡Î¹ÎºÎ¬": "ÏƒÏ…Î½ÎµÎºÎ´Î¿Ï‡Î¹ÎºÎ¬",
        "Ï„Î±Ï…Ï„ÏŒÏƒÎ·Î¼Î±": "Ï„Î±Ï…Ï„ÏŒÏƒÎ·Î¼Î±",
        "Î´Î·Î¼ la": "Î´Î·Î¼ÏÎ´Î·Ï‚ Î»Î±Ï„Î¹Î½Î¹ÎºÎ®",
        "Î´Î·Î¼Î¿Ï„": "Î´Î·Î¼Î¿Ï„Î¹ÎºÎ®",
        "Î´Ï‰Ï": "Î´Ï‰ÏÎ¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚",
        "Ï‡Ï…Î´": "Ï‡Ï…Î´Î±Î¯Î¿",
        "US": "Î—Î Î‘",
        "Î—Î Î‘": "Î—Î Î‘",
        "UK": "Î—Î’",
        "USA": "Î—Î Î‘",
        "Î»Î¿Î³Î¿Ï„": "Î»Î¿Î³Î¿Ï„ÎµÏ‡Î½Î¹ÎºÏŒ",
        "Î»Î¿Îº": "Î»Î¿ÎºÏÎ¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚",
        "Î±Î½Î¸ÏÏ‰Ï€Î¿Î»": "Î±Î½Î¸ÏÏ‰Ï€Î¿Î»Î¿Î³Î¯Î±",
    }.get(tpl, ""):
        return text if data["0"] else term(text)

    if text := {
        "Î±Î¸": "Î±ÏÏƒÎµÎ½Î¹ÎºÏŒ Î® Î¸Î·Î»Ï…ÎºÏŒ",
        "Ï„Î±Ï…Ï„": "Ï„Î±Ï…Ï„ÏŒÏƒÎ·Î¼Î±",
        "Î±Î½Î±Î´ÏÎ¿Î¼Î¹ÎºÏŒÏ‚": "Î±Î½Î±Î´ÏÎ¿Î¼Î¹ÎºÏŒÏ‚ ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚",
        "ÎºÏÎ·Ï„ Î±ÏÏ‡": "ÎºÏÎ·Ï„Î¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚",
        "Î»Î±Ï„": "Î»Î±Ï„Î¹Î½Î¹ÎºÎ¬",
        "Ï…ÏƒÏ„ÎµÏÎ¿ la": "Ï…ÏƒÏ„ÎµÏÎ¿Î»Î±Ï„Î¹Î½Î¹ÎºÎ®",
        "Î±Î½Ï„Î¹Î´Î¬Î½ÎµÎ¹Î¿": "Î±Î½Ï„Î¹Î´Î¬Î½ÎµÎ¹Î¿",
        "Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹": "Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹",
        "ÏƒÏ…Î½Ï‰Î½": "ÏƒÏ…Î½ÏÎ½Ï…Î¼Î±",
        "ÏƒÏ…Î½ÏÎ½": "ÏƒÏ…Î½ÏÎ½Ï…Î¼Î±",
        "Ï€Î¿Î¹Î·Ï„": "Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒÏ‚ Ï„ÏÏ€Î¿Ï‚",
    }.get(tpl, ""):
        return text if data["0"] else italic(text)

    if text := {
        "ÎºÎ±Î¸Î±Ï": "ÎºÎ±Î¸Î±ÏÎµÏÎ¿Ï…ÏƒÎ±",
        "Î³ÎµÎ½Î¹Îº": "Î³ÎµÎ½Î¹ÎºÏŒÏ„ÎµÏÎ±",
    }.get(tpl, ""):
        return italic(text) if data["0"] else term(text)

    if tpl == "Î³Ï":
        desc = parts[1] if len(parts) > 1 else ""
        desc = {
            "": "Î¬Î»Î»Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Î±Ï€Î»Î¿Ï€": "Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Î¼Î· Î±Ï€Î»Î¿Ï€": "Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Î±ÏƒÏ…Î½": "Î±ÏƒÏ…Î½Î±Î¯ÏÎµÏ„Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…",
            "ÎµÏ„Ï…Î¼": "ÎµÏ„Ï…Î¼Î¿Î»Î¿Î³Î¹ÎºÎ® Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Î¼Î¿Î½Î¿": "Î¼Î¿Î½Î¿Ï„Î¿Î½Î¹ÎºÎ® Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Î¼Î¿ÏÏ†Î®": "Î¬Î»Î»Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…",
            "Ï€Î¿Î»Ï…": "Ï€Î¿Î»Ï…Ï„Î¿Î½Î¹ÎºÎ® Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Ï€Î¿Î»": "Ï€Î¿Î»Ï…Ï„Î¿Î½Î¹ÎºÎ® Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "Ï€Î±ÏÏ‰Ï‡": "Ï€Î±ÏÏ‰Ï‡Î·Î¼Î­Î½Î· Î³ÏÎ±Ï†Î® Ï„Î¿Ï…",
            "ÏƒÎ½Ï": "ÏƒÏ…Î½Î·ÏÎ·Î¼Î­Î½Î· Î¼Î¿ÏÏ†Î® Ï„Î¿Ï…",
            "ÏƒÏ…Î½Ï‰Î½": "ÏƒÏ…Î½ÏÎ½Ï…Î¼Î¿ Ï„Î¿Ï…",
        }.get(desc, desc)
        return f"{italic(desc)} {strong(data['ÎµÎ¼Ï†'] or parts[0])}"

    if tpl in {"Ï€ÏÏŒÏƒÏ†", "Ï€ÏÎ¿ÏƒÏ†"}:
        words = [data[f".{idx}"] or part for idx, part in enumerate(parts, 1)]
        return concat(words, " + ")

    # This is a country in the current locale
    if lang := langs.get(tpl):
        return str(lang["name"])

    #
    # Variants
    #
    if tpl.startswith(("infl", "ÎºÎ»", "Î¸Î·Î» Ï„Î¿Ï…", "Î¸Î·Î»_Ï„Î¿Ï…", "Ï€Ï„ÏÏƒÎµÎ¹Ï‚ÎŸÎ‘ÎšÏ€Î»")):
        return parts[-1]

    return defaults.last_template_handler(template, locale, word=word, all_templates=all_templates)


random_word_url = "https://el.wiktionary.org/wiki/%CE%95%CE%B9%CE%B4%CE%B9%CE%BA%CF%8C:RandomRootpage"
